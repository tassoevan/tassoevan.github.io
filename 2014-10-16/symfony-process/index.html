<!DOCTYPE html><html lang="pt-BR"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 5.13.7"/><meta name="theme-color" content="#ececec"/><meta name="description" content="Como converter um PDF em imagens PNG ou JPEG, usando PHP? Como converter arquivos de vídeo enviados via upload em formatos para a web, como…" data-gatsby-head="true"/><meta property="og:title" content="Adeus shell_exec() | Tasso &amp; As Vozes" data-gatsby-head="true"/><meta property="og:description" content="Como converter um PDF em imagens PNG ou JPEG, usando PHP? Como converter arquivos de vídeo enviados via upload em formatos para a web, como…" data-gatsby-head="true"/><meta property="og:type" content="website" data-gatsby-head="true"/><meta name="twitter:card" content="summary" data-gatsby-head="true"/><meta name="twitter:creator" content="@tassoevan" data-gatsby-head="true"/><meta name="twitter:title" content="Adeus shell_exec() | Tasso &amp; As Vozes" data-gatsby-head="true"/><meta name="twitter:description" content="Como converter um PDF em imagens PNG ou JPEG, usando PHP? Como converter arquivos de vídeo enviados via upload em formatos para a web, como…" data-gatsby-head="true"/><style data-href="/styles.e12c7c9c885ec3ebdd07.css" data-identity="gatsby-global-css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{-webkit-text-size-adjust:100%;line-height:1.15}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}</style><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" title="Tasso &amp; As Vozes" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=3bc3484dc4dbb659702eb81db86fa199" type="image/png"/><link rel="icon" href="/favicon.svg?v=3bc3484dc4dbb659702eb81db86fa199" type="image/svg+xml"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=3bc3484dc4dbb659702eb81db86fa199"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=3bc3484dc4dbb659702eb81db86fa199"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=3bc3484dc4dbb659702eb81db86fa199"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=3bc3484dc4dbb659702eb81db86fa199"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=3bc3484dc4dbb659702eb81db86fa199"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=3bc3484dc4dbb659702eb81db86fa199"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=3bc3484dc4dbb659702eb81db86fa199"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=3bc3484dc4dbb659702eb81db86fa199"/><style data-styled="" data-styled-version="6.1.13">html{font-size:100%;font-family:Baskerville,'Baskerville Old Face','Goudy Old Style',Garamond,'Times New Roman',serif;scroll-behavior:smooth;}/*!sc*/
body{font-size:1rem;line-height:1.5;margin:0;color:hsl(0deg, 0%, 30%);background-color:#ececec;padding:1rem;}/*!sc*/
h1,h2,h3,h4,h5,h6{line-height:1.1;font-family:inherit;font-weight:700;margin-top:3rem;margin-bottom:1.5rem;overflow-wrap:break-word;word-wrap:break-word;-ms-word-break:break-all;word-break:break-word;-ms-hyphens:auto;-moz-hyphens:auto;-webkit-hyphens:auto;hyphens:auto;}/*!sc*/
h1{font-size:2.35em;}/*!sc*/
h2{font-size:2.00em;}/*!sc*/
h3{font-size:1.75em;}/*!sc*/
h4{font-size:1.5em;}/*!sc*/
h5{font-size:1.25em;}/*!sc*/
h6{font-size:1em;}/*!sc*/
p{margin-top:0px;margin-bottom:2.5rem;}/*!sc*/
small,sub,sup{font-size:75%;}/*!sc*/
hr{border-color:rgb(46, 170, 190);}/*!sc*/
a{text-decoration:none;color:rgb(46, 170, 190);}/*!sc*/
a:hover{color:rgba(46, 170, 190, 90%);border-bottom:1px dashed hsl(0deg, 0%, 30%);}/*!sc*/
ul{padding-left:1.4em;margin-top:0px;margin-bottom:2.5rem;}/*!sc*/
li{margin-bottom:0.4em;}/*!sc*/
blockquote{font-style:italic;margin-left:1.5em;padding-left:1em;border-left:3px solid rgb(46, 170, 190);}/*!sc*/
img{height:auto;max-width:100%;margin-top:0px;margin-bottom:2.5rem;}/*!sc*/
pre{background-color:hsla(0deg, 0%, 30%, 10%);display:block;padding:1em;overflow-x:auto;margin-top:0px;margin-bottom:2.5rem;}/*!sc*/
code{font-size:0.9em;padding:0 0.5em;background-color:hsla(0deg, 0%, 30%, 10%);white-space:pre-wrap;}/*!sc*/
pre>code{padding:0;background-color:transparent;white-space:pre;}/*!sc*/
table{text-align:justify;width:100%;border-collapse:collapse;}/*!sc*/
td,th{padding:0.5em;border-bottom:1px solid hsla(0deg, 0%, 30%, 10%);}/*!sc*/
input,textarea{border:1px solid hsl(0deg, 0%, 30%);}/*!sc*/
input:focus,textarea:focus{border:1px solid rgb(46, 170, 190);}/*!sc*/
textarea{width:100%;}/*!sc*/
.button,button,input[type="submit"],input[type="reset"],input[type="button"]{display:inline-block;padding:5px 10px;text-align:center;text-decoration:none;white-space:nowrap;background-color:rgb(46, 170, 190);color:#ececec;border-radius:1px;border:1px solid rgb(46, 170, 190);cursor:pointer;box-sizing:border-box;}/*!sc*/
.button[disabled],button[disabled],input[type="submit"][disabled],input[type="reset"][disabled],input[type="button"][disabled]{cursor:default;opacity:.5;}/*!sc*/
.button:focus,button:focus,input[type="submit"]:focus,input[type="reset"]:focus,input[type="button"]:focus,.button:hover,button:hover,input[type="submit"]:hover,input[type="reset"]:hover,input[type="button"]:hover{background-color:rgba(46, 170, 190, 90%);border-color:rgba(46, 170, 190, 90%);color:#ececec;outline:0;}/*!sc*/
textarea,select,input[type]{color:hsl(0deg, 0%, 30%);padding:6px 10px;margin-bottom:10px;background-color:hsla(0deg, 0%, 30%, 10%);border:1px solid hsla(0deg, 0%, 30%, 10%);border-radius:4px;box-shadow:none;box-sizing:border-box;}/*!sc*/
textarea:focus,select:focus,input[type]:focus{border:1px solid rgb(46, 170, 190);outline:0;}/*!sc*/
input[type="checkbox"]:focus{outline:1px dotted rgb(46, 170, 190);}/*!sc*/
label,legend,fieldset{display:block;margin-bottom:.5rem;font-weight:600;}/*!sc*/
data-styled.g1[id="sc-global-bfEceD1"]{content:"sc-global-bfEceD1,"}/*!sc*/
.dHyCaE{display:none;}/*!sc*/
data-styled.g2[id="Layout__BodyTitle-sc-uy8b5k-0"]{content:"dHyCaE,"}/*!sc*/
.hzMRuC h1{font-size:1em;font-weight:normal;margin:0;}/*!sc*/
data-styled.g3[id="NavBar__StyledNavBar-sc-yc90xv-0"]{content:"hzMRuC,"}/*!sc*/
.fFhCYn{max-width:38em;margin:0 auto;}/*!sc*/
data-styled.g4[id="Post__StyledPost-sc-1lj2z18-0"]{content:"fFhCYn,"}/*!sc*/
.hVHmJF{border-top:1pt dashed currentColor;text-align:right;text-align:end;}/*!sc*/
data-styled.g5[id="Post__NextArticle-sc-1lj2z18-1"]{content:"hVHmJF,"}/*!sc*/
</style><title data-gatsby-head="true">Adeus shell_exec() | Tasso &amp; As Vozes</title></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><h1 class="Layout__BodyTitle-sc-uy8b5k-0 dHyCaE">Adeus shell_exec()</h1><nav class="NavBar__StyledNavBar-sc-yc90xv-0 hzMRuC"><h1><a title="Um lugar calmo e tranquilo onde dialogo com as vozes que habitam a minha cabeça" href="/">Tasso &amp; As Vozes</a></h1></nav><div class="Post__StyledPost-sc-1lj2z18-0 fFhCYn"><header><h2><a aria-current="page" class="" href="/2014-10-16/symfony-process/">Adeus shell_exec()</a></h2><div><time dateTime="2014-10-17T06:00:00.000Z">17 de outubro de 2014 às 06:00</time> <!-- -->· <!-- -->10<!-- --> <!-- -->minutos</div></header><article><p>Como <a href="http://stackoverflow.com/questions/13600598/convert-pdf-to-jpg-image-with-php">converter um PDF em imagens PNG ou JPEG</a>, <em>usando PHP</em>? Como <a href="http://stackoverflow.com/questions/1571134/how-can-i-convert-an-avi-file-to-flv-format-with-php">converter arquivos de vídeo enviados via upload em formatos para a web</a>, como WebM ou FLV, <em>usando PHP</em>? Como realizar uma tarefa administrativa no servidor, <em>usando PHP</em>?</p>
<p>Muitas vezes nos fazemos essas perguntas e passamos por algumas decepções ao procurar soluções. A primeira é descobrir que nem sempre podemos resolver usando única e exclusivamente a linguagem e/ou tecnologia que usamos em nossos projetos: PHP não foi construída para executar tarefas longas e que demandam alto processamento, como converter formatos de imagem, áudio e vídeo. Até podemos considerar o uso de extensões (como a <a href="http://php.net/manual/en/book.imagick.php">ImageMagick</a>), mas geralmente o modo rápido de conseguir o que se quer é através de <strong>programas externos</strong>, como <code>avconv</code> e <code>convert</code>.</p>
<p>A principal dificuldade esperada ao realizar a integração entre scripts PHP e programas externos é a perda de compatibilidade nas diversas plataformas em que PHP é executável. A maioria dos exemplos de uso das funções <code>exec()</code>, <code>shell_exec()</code> e <code>passthru()</code> utiliza programas do ecossistema Unix e, ao menos no Brasil, o número de desenvolvedores PHP que rodam Windows em suas estações de trabalho é grande. Para eles, usar programas externos é adicionar ao seu código algo que só poderá ser testado em servidores de teste ou desenvolvimento — uma realidade que vem mudando, a passos de formiga, com a adoção de ferramentas como <a href="http://www.vagrantup.com/">Vagrant</a> e <a href="http://www.docker.com/">Docker</a>.</p>
<p>Então é simples usar programas externos? Não. Todo programa é executado como um novo <strong>processo</strong> do sistema, chamado pelo <strong>shell</strong> através de uma <strong>linha de comando</strong>. E neste contexto, existem algumas coisas a se considerar:</p>
<ol>
<li>Deve ser garantido que nenhum número abusivo de processos seja executado;</li>
<li>Deve ser garantido que <a href="http://en.wikipedia.org/wiki/Code_injection#Shell_injection">nenhum dado enviado execute código arbitrário</a>;</li>
<li>Todo processo possui uma <a href="http://en.wikipedia.org/wiki/Standard_streams#Standard_input_.28stdin.29">stream de entrada de dados</a>, uma <a href="http://en.wikipedia.org/wiki/Standard_streams#Standard_output_.28stdout.29">stream de saída normal</a> e uma <a href="http://en.wikipedia.org/wiki/Standard_streams#Standard_error_.28stderr.29">stream de saída de erros</a>;</li>
<li>Alguns processos exigem interação do usuário através da stream de entrada;</li>
<li>Alguns processos são longos;</li>
<li>Alguns processos escrevem dados em formatos complexos nas streams de saída;</li>
<li>Processos retornam um <a href="http://en.wikipedia.org/wiki/Exit_status">código de status de fim de execução</a> que indica erros ocorridos durante a execução.</li>
</ol>
<p>Vamos ver que opções as funções padrão do PHP nos fornecem para trabalhar com processos:</p>
<h1><a href="http://php.net/manual/en/function.shell-exec.php"><code>string shell_exec(string $cmd)</code></a> ou <a href="http://php.net/manual/en/language.operators.execution.php"><code>`$cmd`</code></a></h1>
<p>É a função ideal para processos invocados com uma linha de comando simples e que escrevem apenas uma linha de texto na stream de saída.</p>
<ol>
<li>Somente um processo pode ser executado por vez, a menos que se utilizem mecanismos de execução paralela presentes no shell (e.g. <code>start convert doc.pdf images.jpg</code> em Windows).</li>
<li>Você depende de <code>escapeshellarg($arg)</code> para escapar argumentos vindos da entrada de usuário. Usar ou não usar é por sua conta e risco. Para o operador de execução (<code>` `</code>) é impossível passar dados de usuário, como se a definição da linha de comando do processo fosse constante.</li>
<li>Tudo o que foi escrito na stream de saída é retornado pela função. Em caso de erro, entretanto, é retornado o valor <code>NULL</code>, mesmo que dados tenham sido escritos.</li>
<li>Não permite escrever dados na stream de entrada.</li>
<li>Você não pode definir um tempo máximo para a execução do processo, embora fique limitado pelo limite de tempo de execução do próprio script PHP.</li>
<li>Você precisa parsear toda a stream de saída obtida através do retorno da função/expressão.</li>
<li>Você não obtém o código de status. Se ele for zero, a função retorna o conteúdo da stream de saída; caso contrário, <code>NULL</code> é retornado.</li>
</ol>
<h1><a href="http://php.net/manual/en/function.exec.php"><code>string exec(string $command[, array &amp;$output[, int &amp;$return_var]])</code></a></h1>
<p>Esta função adiciona um grau maior de controle sob o que é escrito na stream de saída e sobre os códigos de status.</p>
<ol>
<li>Somente um processo pode ser executado por vez, a menos que se utilizem mecanismos de execução paralela presentes no shell.</li>
<li>Você depende de <code>escapeshellarg($arg)</code> para escapar argumentos vindos da entrada de usuário. Usar ou não usar é por sua conta e risco.</li>
<li>Você pode ter acesso ao que foi escrito na stream de saída através do array <code>$output</code> ou apenas da última linha escrita através do retorno da função.</li>
<li>Não permite escrever dados na stream de entrada.</li>
<li>Você não pode definir um tempo máximo para a execução do processo, embora fique limitado pelo limite de tempo de execução do próprio script PHP.</li>
<li>Você precisa parsear toda a stream de saída obtida através de <code>$output</code>.</li>
<li>Você obtém o código de status através de <code>$return_var</code>.</li>
</ol>
<h1><a href="http://php.net/manual/en/function.passthru.php"><code>void passthru(string $command[, int &amp;$return_var])</code></a></h1>
<p>O uso mais comum desta função é quando o script PHP funciona como um simples proxy para um programa externo, como um gerador de imagens ou compilador.</p>
<ol>
<li>Somente um processo pode ser executado por vez, a menos que se utilizem mecanismos de execução paralela presentes no shell.</li>
<li>Você depende de <code>escapeshellarg($arg)</code> para escapar argumentos vindos da entrada de usuário. Usar ou não usar é por sua conta e risco.</li>
<li>A stream de saída do processo é redirecionada para a stream de saída do script PHP. Se você quiser capturar a saída, vai ter que utilizar mecanismos de <em>output buffering</em> (<code>ob_start()</code>).</li>
<li>Não permite escrever dados na stream de entrada.</li>
<li>Você não pode definir um tempo máximo para a execução do processo, embora fique limitado pelo limite de tempo de execução do próprio script PHP.</li>
<li>Você precisa parsear toda a stream de saída obtida através de <em>output buffering</em>.</li>
<li>Você obtém o código de status através de <code>$return_var</code>.</li>
</ol>
<h1><a href="php.net/manual/en/function.proc-open.php"><code>resource proc_open(string $cmd, array $descriptorspec, array &amp;$pipes[, string $cwd[, array $env[, array $other_options]]])</code></a></h1>
<p>E aqui temos o maior controle possível de processos (inclusive do diretório de trabalho do processo, via <code>$cwd</code>) através de scripts PHP.</p>
<ol>
<li>Esta função é não-bloqueante, de modo que você pode iniciar quantos processos julgar adequado. Vale o bom senso para garantir que uma quantidade não-abusiva de processos sejam rodados paralelamente.</li>
<li>Você depende de <code>escapeshellarg($arg)</code> para escapar argumentos vindos da entrada de usuário. Usar ou não usar é por sua conta e risco.</li>
<li>Você tem acesso a <em>stdin</em>, <em>stdout</em> e <em>stderr</em> através do array <code>$pipes</code>, como se fossem ponteiros de arquivo tradicionais.</li>
<li><em>stdin</em> é uma stream de escrita, onde você pode escrever usando funções simples como <code>fwrite()</code>.</li>
<li>O controle de <em>timeout</em> dos processos pode ser implementado, já que o processo roda paralelamente ao script.</li>
<li>A leitura dos dados escritos em <em>stdout</em> e <em>stderr</em> não difere da leitura de um arquivo; assim, as mesmas técnicas empregadas para parsear um arquivo podem ser aplicadas, seja de forma integral (ler toda a stream e interpretar o formato), seja de forma contínua (ler a stream linha a linha e interpretar durante a execução).</li>
<li>Você pode ter o código de status a partir do retorno de <code>proc_close($process)</code>.</li>
</ol>
<h1>Tudo é complicado</h1>
<p>Pelo que se percebe, a complexidade para se executar certos processos via PHP é semelhante à própria complexidade do processo, i.e., um processo que exige interação com todas as streams, <em>timeout</em> e controle do código de status vai demandar o uso de uma função muito complexa. <a href="http://php.net/manual/en/function.proc-open.php#example-3774">Veja você mesmo</a>:</p>
<pre><code class="language-php">&lt;?php
$descriptorspec = array(
   0 =&gt; array(&quot;pipe&quot;, &quot;r&quot;),  // stdin is a pipe that the child will read from
   1 =&gt; array(&quot;pipe&quot;, &quot;w&quot;),  // stdout is a pipe that the child will write to
   2 =&gt; array(&quot;file&quot;, &quot;/tmp/error-output.txt&quot;, &quot;a&quot;) // stderr is a file to write to
);

$cwd = &#x27;/tmp&#x27;;
$env = array(&#x27;some_option&#x27; =&gt; &#x27;aeiou&#x27;);

$process = proc_open(&#x27;php&#x27;, $descriptorspec, $pipes, $cwd, $env);

if (is_resource($process)) {
    // $pipes now looks like this:
    // 0 =&gt; writeable handle connected to child stdin
    // 1 =&gt; readable handle connected to child stdout
    // Any error output will be appended to /tmp/error-output.txt

    fwrite($pipes[0], &#x27;&lt;?php print_r($_ENV); ?&gt;&#x27;);
    fclose($pipes[0]);

    echo stream_get_contents($pipes[1]);
    fclose($pipes[1]);

    // It is important that you close any pipes before calling
    // proc_close in order to avoid a deadlock
    $return_value = proc_close($process);

    echo &quot;command returned $return_value\n&quot;;
}
</code></pre>
<p>Nesse exemplo, abrimos o processo <code>php</code>, escrevemos na stream de entrada o código <code>&lt;?php print_r($_ENV); ?&gt;</code> e lemos o resultado da execução na stream de saída do processo. Nenhum mecanismo de <em>timeout</em> é implementado, bem como nenhum controle de erros é realizado através da stream de erros e do código de status, e mesmo assim temos um código assustador para programadores novatos.</p>
<h2>Symfony Process ao resgate</h2>
<p>Streams, código de status, <em>timeout</em>, diretório de trabalho, argumentos escapados... Muitos são os componentes e detalhes presentes na execução de um processo. Para nossa sorte, o componente <a href="http://symfony.com/doc/current/components/process.html">Symfony Process</a> provê um mecanismo simples para execução e controle de processos (e ao contrário do que muitos pensam <strong>não é necessário estar utilizando o framework Symfony para usufruir deste componente</strong>). Vamos recriar o exemplo supracitado para demonstrar isso.</p>
<p>Primeiramente, você pode baixar as classes do Symfony Process de modo tradicional, mas isso é desaconselhado; prefira fazer o controle deste e de demais códigos de terceiros através do <a href="https://getcomposer.org">Composer</a>, um gerenciador de dependências para PHP que se tornou praticamente o padrão da indústria. Caso você ainda não esteja utilizando no seu projeto, execute no terminal</p>
<pre><code class="language-sh">$ composer init
</code></pre>
<p>E forneça informações básicas do seu projeto. Assim que o arquivo <code>composer.json</code> estiver disponível, execute</p>
<pre><code class="language-sh">$ composer require symfony/process
</code></pre>
<p>Para adicionar ao seu projeto a última versão do componente Symfony Process. Todo o código fica disponível no diretório <code>vendor/symfony/process</code> e o arquivo <code>composer.lock</code> é criado para registrar qual a versão utilizada.</p>
<p>Com a library em mãos, vamos recriar o exemplo passo-a-passo. Escreva, num arquivo chamado <code>exemplo.php</code>, as seguintes linhas:</p>
<pre><code class="language-php">&lt;?php
require __DIR__.&#x27;/vendor/autoload.php&#x27;;

use Symfony\Component\Process\Process;
</code></pre>
<p>A primeira linha vai adicionar o autoloader do Composer, tornando acessíveis todas as classes do Symfony Process. A linha seguinte permite que a classe <code>Symfony\Component\Process\Process</code> possa ser chamada apenas de <code>Process</code> no script. Ainda no mesmo arquivo, escreva:</p>
<pre><code class="language-php">$process = new Process(&#x27;php&#x27;);
</code></pre>
<p>Essa linha não executa o processo <code>php</code> de imediato, apenas prepara uma instância da classe <code>Process</code> que representa um processo antes, durante, e após sua execução.</p>
<pre><code class="language-php">$process-&gt;setInput(&#x27;&lt;?php print_r($_ENV); ?&gt;&#x27;);
</code></pre>
<p>Aqui foi definido qual conteúdo será escrito em <em>stdin</em> que o processo seja executado (esse método lança <code>RuntimeException</code> se é executado depois que o processo é executado).</p>
<pre><code class="language-php">$process-&gt;run(function ($type, $buffer) {
    if (Process::ERR === $type) {
        echo &#x27;ERR &gt; &#x27;.$buffer;
    } else {
        echo &#x27;OUT &gt; &#x27;.$buffer;
    }
});
</code></pre>
<p>Aqui o processo é executado de fato, de forma síncrona (para executar o processo de forma asíncrona, <code>$process-&gt;start()</code> deve ser invocado no lugar de <code>$process-&gt;run()</code>), mas com um adendo: toda saída gerada pelo processo, em <em>stdout</em> e <em>stderr</em>, é passada imediatamente para o callable passado como parâmetro do método <code>run()</code> (neste caso, é uma closure). O callable deve aceitar dois parâmetros: <code>$type</code>, que indica se a saída foi escrita em <em>stdout</em> ou <em>stderr</em>; <code>$buffer</code>, que contém o texto escrito.</p>
<p>E... Isso é tudo. Você não precisa fechar o processo, muito menos pará-lo. Segue o exemplo completo:</p>
<pre><code class="language-php">&lt;?php
require __DIR__.&#x27;/vendor/autoload.php&#x27;;

use Symfony\Component\Process\Process;

$process = new Process(&#x27;php&#x27;);
$process-&gt;setInput(&#x27;&lt;?php print_r($_ENV); ?&gt;&#x27;);
$process-&gt;run(function ($type, $buffer) {
    if (Process::ERR === $type) {
        echo &#x27;ERR &gt; &#x27;.$buffer;
    } else {
        echo &#x27;OUT &gt; &#x27;.$buffer;
    }
});

</code></pre>
<h3>Agora vá!</h3>
<p>Espero que este artigo tenha instigado o leitor investir um pouco de atenção ao componente Symfony Process. As possibilidades com ele são interessantes, principalmente se o seu desejo for de adicionar poder de fogo à sua aplicação web. Em breve devo demonstrar mais casos de uso, como invocação de <code>convert</code>, <code>avconv</code> e <code>rsync</code>. Até lá!</p></article><footer class="Post__NextArticle-sc-1lj2z18-1 hVHmJF"><a href="/2014-09-23/webbr/">Contagem regressiva para a Web.br 2014!</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-31191590-3', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2014-10-16/symfony-process/";/*]]>*/</script><!-- slice-start id="_gatsby-scripts-1" -->
          <script
            id="gatsby-chunk-mapping"
          >
            window.___chunkMapping="{\"app\":[\"/app-aeb1de4a19f10e12759c.js\"],\"component---src-pages-index-tsx\":[\"/component---src-pages-index-tsx-15e061f93cee571c6428.js\"],\"component---src-templates-post-tsx-content-file-path-posts-2013-03-21-htaccess-snippets-md\":[\"/component---src-templates-post-tsx-content-file-path-posts-2013-03-21-htaccess-snippets-md-8858e8fb49036ebe69f6.js\"],\"component---src-templates-post-tsx-content-file-path-posts-2013-04-05-inicializacao-basica-de-plugins-jquery-md\":[\"/component---src-templates-post-tsx-content-file-path-posts-2013-04-05-inicializacao-basica-de-plugins-jquery-md-e1891f60772d685e300f.js\"],\"component---src-templates-post-tsx-content-file-path-posts-2013-05-06-acesso-facil-a-classe-respect-validation-validator-md\":[\"/component---src-templates-post-tsx-content-file-path-posts-2013-05-06-acesso-facil-a-classe-respect-validation-validator-md-fd4c6ba83bbdf16ede3f.js\"],\"component---src-templates-post-tsx-content-file-path-posts-2013-07-19-um-metodo-mais-confiavel-para-serializar-closures-md\":[\"/component---src-templates-post-tsx-content-file-path-posts-2013-07-19-um-metodo-mais-confiavel-para-serializar-closures-md-3cd07f0bcc40b84784ef.js\"],\"component---src-templates-post-tsx-content-file-path-posts-2013-07-24-interpretando-urls-com-dom-md\":[\"/component---src-templates-post-tsx-content-file-path-posts-2013-07-24-interpretando-urls-com-dom-md-974b7464993179bf3ba5.js\"],\"component---src-templates-post-tsx-content-file-path-posts-2014-04-10-a-forma-mais-para-habilitar-conexoes-ao-banco-de-dados-oracle-no-php-5-rodando-sobre-o-ubuntu-md\":[\"/component---src-templates-post-tsx-content-file-path-posts-2014-04-10-a-forma-mais-para-habilitar-conexoes-ao-banco-de-dados-oracle-no-php-5-rodando-sobre-o-ubuntu-md-17640b01c4d4d05d1910.js\"],\"component---src-templates-post-tsx-content-file-path-posts-2014-07-21-higiene-e-seguranca-em-escritorios-de-ti-md\":[\"/component---src-templates-post-tsx-content-file-path-posts-2014-07-21-higiene-e-seguranca-em-escritorios-de-ti-md-c498adc4e408aa458454.js\"],\"component---src-templates-post-tsx-content-file-path-posts-2014-09-23-webbr-md\":[\"/component---src-templates-post-tsx-content-file-path-posts-2014-09-23-webbr-md-ff0596a15b8a91ca05f4.js\"],\"component---src-templates-post-tsx-content-file-path-posts-2014-10-16-symfony-process-md\":[\"/component---src-templates-post-tsx-content-file-path-posts-2014-10-16-symfony-process-md-ddb482add9851da4502e.js\"],\"component---src-templates-post-tsx-content-file-path-posts-2014-12-03-git-para-times-de-todos-os-tamanhos-md\":[\"/component---src-templates-post-tsx-content-file-path-posts-2014-12-03-git-para-times-de-todos-os-tamanhos-md-c158a2f59588585af75e.js\"],\"component---src-templates-post-tsx-content-file-path-posts-2015-06-06-como-instalar-e-usar-o-composer-md\":[\"/component---src-templates-post-tsx-content-file-path-posts-2015-06-06-como-instalar-e-usar-o-composer-md-6f4ea0bcb346de2ff924.js\"],\"component---src-templates-post-tsx-content-file-path-posts-2015-08-14-instalando-o-composer-com-o-composer-md\":[\"/component---src-templates-post-tsx-content-file-path-posts-2015-08-14-instalando-o-composer-com-o-composer-md-3300632529d12adcb6bc.js\"],\"component---src-templates-post-tsx-content-file-path-posts-2020-05-23-dark-mode-nao-adaptativo-uma-escolha-puramente-estetica-md\":[\"/component---src-templates-post-tsx-content-file-path-posts-2020-05-23-dark-mode-nao-adaptativo-uma-escolha-puramente-estetica-md-d80dd615412dc03e22c2.js\"],\"component---src-templates-post-tsx-content-file-path-posts-2020-05-23-uma-sugestao-para-simular-um-e-paper-md\":[\"/component---src-templates-post-tsx-content-file-path-posts-2020-05-23-uma-sugestao-para-simular-um-e-paper-md-d63a9e4e593967276214.js\"],\"component---src-templates-post-tsx-content-file-path-posts-2020-05-24-notas-sobre-the-great-coffeescript-to-typescript-migration-of-2017-md\":[\"/component---src-templates-post-tsx-content-file-path-posts-2020-05-24-notas-sobre-the-great-coffeescript-to-typescript-migration-of-2017-md-ba7cebdbfac85d579b7e.js\"]}";
          </script>
        <script>window.___webpackCompilationHash="f7a53dd9d1d09124cdf5";</script><script src="/webpack-runtime-58fddc270ba59e2793f7.js" async></script><script src="/framework-dde42e90489f8ef963ab.js" async></script><script src="/app-aeb1de4a19f10e12759c.js" async></script><!-- slice-end id="_gatsby-scripts-1" --></body></html>