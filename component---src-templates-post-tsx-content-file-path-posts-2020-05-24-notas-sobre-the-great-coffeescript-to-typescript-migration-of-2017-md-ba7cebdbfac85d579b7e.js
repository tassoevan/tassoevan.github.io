"use strict";(self.webpackChunk_tassoevan_tassoevan_github_io=self.webpackChunk_tassoevan_tassoevan_github_io||[]).push([[809],{849:function(e,t,a){a.r(t),a.d(t,{Head:function(){return f},default:function(){return p}});var n=a(8453),o=a(6540);function r(e){const t=Object.assign({p:"p",h2:"h2",ul:"ul",li:"li",em:"em",code:"code",a:"a",ol:"ol"},(0,n.R)(),e.components);return o.createElement(o.Fragment,null,o.createElement(t.p,null,"Fonte: https://dropbox.tech/frontend/the-great-coffeescript-to-typescript-migration-of-2017"),"\n",o.createElement(t.h2,null,"Pré-história: adoção de CoffeeScript"),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"Em 2012, o Dropbox era uma startup com 150 funcionários."),"\n",o.createElement(t.li,null,"ES5 e jQuery dominavam o desenvolvimento JavaScript."),"\n",o.createElement(t.li,null,"A codebase consistia de cerca de 100 mil linhas de JavaScript empacotada por simples concatenação de arquivos."),"\n",o.createElement(t.li,null,"Dois engenheiros migraram tudo para CoffeeScript em uma semana."),"\n",o.createElement(t.li,null,"Em 2013, adotaram o sistema de módulos RequireJS (AMD) já que CommonJS era restrita a Node e, portanto, não projetada para uso no browser."),"\n"),"\n",o.createElement(t.h2,null,"Rumores de uma mudança de linguagem"),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"Ao final de 2015, ES6 já tinha mais funcionalidades que CoffeeScript."),"\n",o.createElement(t.li,null,"Alguns times começaram a adotar ES6 em projetos isolados."),"\n",o.createElement(t.li,null,"A codebase era difícil de manter pois as técnicas de codificação defensiva eram insuficientes e prejudicavam a legibilidade do código."),"\n",o.createElement(t.li,null,"Por CoffeeScript ser menos estrita que Python no uso de whitespaces, alguns engenheiros verificavam manualmente o código JavaScript gerado; é citado um bug sério no outono de 2013 causado por um espaço em branco mal-posicionado."),"\n",o.createElement(t.li,null,"Uma pesquisa interna em novembro de 2015 verificou que 62% dos desenvolvedores gostariam de mudar a linguagem utilizada."),"\n",o.createElement(t.li,null,"Problemas com CoffeeScript apontados:","\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"Falta de delimitadores"),"\n",o.createElement(t.li,null,o.createElement(t.em,null,"Syntactic sugar")," muito opinativo"),"\n",o.createElement(t.li,null,"Falta de suporte da comunidade"),"\n",o.createElement(t.li,null,"Leitura difícil pois a sintaxe é muito densa"),"\n",o.createElement(t.li,null,"Sujeita a erros por causa de ambiguidades sintáticas"),"\n"),"\n"),"\n",o.createElement(t.li,null,"O ferramental de TypeScript parecia melhor que vanilla ES6 + Flow no final de 2015."),"\n",o.createElement(t.li,null,"No primeiro semestre de 2016, um engenheiro integrou Babel e TypeScript."),"\n",o.createElement(t.li,null,"Tanto o time quanto a codebase (330 mil linhas) haviam crescido significativamente para uma migração indolor."),"\n"),"\n",o.createElement(t.h2,null,"Um plano de migração otimista"),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"Foram estabelecidas cinco ",o.createElement(t.em,null,"milestones")," a serem cumpridas até julho de 2017:\nM1. Suporte básico a TypeScript com interoperabilidade com CoffeeScript e ferramentas de i18n, lint e testes;\nM2. Documentar boas práticas e guias de migração e migrar as principais bibliotecas e módulos para TypeScript ser a linguagem padrão de desenvolvimento;\nM3. Consolidar a ",o.createElement(t.em,null,"milestone")," anterior migrando o restante de módulos e bibliotecas;\nM4. Migrar os arquivos mais modificados ao longo do tempo no projeto;\nM5. Remover o compilador de CoffeeScript."),"\n",o.createElement(t.li,null,"M1, M2 e M3 foram executadas no segundo semestre de 2016."),"\n",o.createElement(t.li,null,"M4 e M5 foram mais problemáticas; esperava-se que o código ficaria a cargo dos times que o desenvolveram originalmente."),"\n",o.createElement(t.li,null,'20% do time de produto foi alocado para trabalhar nas "fundações" da codebase.'),"\n"),"\n",o.createElement(t.h2,null,"Interoperabilidade de CoffeeScript/TypeScript"),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"Para cada arquivo de CoffeeScript (",o.createElement(t.code,null,"*.coffee"),"), foi criado um arquivo de declarações (",o.createElement(t.code,null,"*.d.ts"),") exportando os módulos como ",o.createElement(t.code,null,"any"),"."),"\n",o.createElement(t.li,null,"Módulos em TS com ",o.createElement(t.code,null,"export default value;")," eram importados nos módulos AMD como objetos do tipo ",o.createElement(t.code,null,"{ default: value }"),"; named exports foram migrados com poucos problemas."),"\n",o.createElement(t.li,null,"Em módulos cujos exports eram dinamicamente determinados, exportou-se todos os identificadores possíveis mas com valores ",o.createElement(t.code,null,"undefined")," dinamicamente determinados."),"\n"),"\n",o.createElement(t.h2,null,"Banindo novos arquivos em CoffeeScript"),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"Foi criado um teste automático para barrar a adição de novos arquivos."),"\n",o.createElement(t.li,null,"Este teste quebrou quando uma migração paralela para ",o.createElement(t.a,{href:"https://bazel.build/"},"Bazel")," como sistema de build foi executada, pois a lista de arquivos ",o.createElement(t.code,null,"*.coffee")," estava vazia."),"\n",o.createElement(t.li,null,"Como aprendizado, testes passaram a fazer asserções em suposições (neste caso, de que a lista nunca seria vazia)."),"\n",o.createElement(t.li,null,"A redução da ",o.createElement(t.em,null,"whitelist")," de arquivos permitidos gerava pequenos atrasos no code review."),"\n"),"\n",o.createElement(t.h2,null,"Experiência inicial: não perdemos o ",o.createElement(t.em,null,"syntactic sugar")," do CoffeeScript"),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"A perda de ",o.createElement(t.em,null,"optional chaining")," e ",o.createElement(t.em,null,"nullish coalescing")," foi compensada com a adição de tipagem."),"\n"),"\n",o.createElement(t.h2,null,"Prioridades concorrentes"),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,'No final de 2016, foi criado um time para redesign e reescrita do website em React ("Maestro").'),"\n",o.createElement(t.li,null,"O time do Maestro não conseguiu cumprir o prazo do primeiro trimestre, entregando ao término do segundo o projeto completo em React e TypeScript."),"\n",o.createElement(t.li,null,"A lista de arquivos que deveria ser eliminada na M4 estagnou em 100 arquivos, mas na prática ainda haviam 2000 arquivos em CoffeeScript com manutenção constante."),"\n"),"\n",o.createElement(t.h2,null,"Adiando a M5"),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"Interpretou-se erroneamente que os scripts restantes deveriam ser substituídos pelos arquivos compilados, causando problemas com lint e i18n."),"\n",o.createElement(t.li,null,"Não ficou claro que o objetivo da M5 era reduzir o custo (já pago) de manter o ferramental de CoffeeScript e TypeScript."),"\n",o.createElement(t.li,null,"A migração perdeu seu ETA."),"\n",o.createElement(t.li,null,"A estimativa inicial da migração era de 1000 linhas por dia demandando um ano de trabalho de um único engenheiro; na prática, 100 linhas por dia eram convertidas, significando um tempo de 10 anos ou o trabalho de 10 engenheiros em um ano."),"\n",o.createElement(t.li,null,'Não havia clareza sobre o que era o trabalho "fundamental" que demandaria 20% do time: se infraestrutura ou pagamento de dívida técnica.'),"\n",o.createElement(t.li,null,"Uma migração de sistemas em produção para uma nova distribuição do Ubuntu tomou boa parte da mão-de-obra de infraestrutura."),"\n"),"\n",o.createElement(t.h2,null,"Um novo plano com ",o.createElement(t.code,null,"decaffeinate")),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"Em janeiro de 2017, foi sugerido o uso de ",o.createElement(t.code,null,"decaffeinate")," para as conversões."),"\n",o.createElement(t.li,null,"Uma função de ordenação com i18n não-testada quebrou completamente uma página no browser Safari."),"\n",o.createElement(t.li,null,"A longa lista de bugs semelhantes no ",o.createElement(t.code,null,"decaffeinate")," obrigou se adotar uma conversão mista (manual e automática) que eventualmente ocasiona erros a nível de semântica do código."),"\n",o.createElement(t.li,null,"Seis meses depois, ",o.createElement(t.code,null,"decaffeinate")," parecia suficientemente maduro em comparação à conversão manual."),"\n",o.createElement(t.li,null,"O time entrou em acordo: TypeScript apenas com o tipo ",o.createElement(t.code,null,"any")," era preferível a CoffeeScript não-tipado e habilitaria os times a introduzirem tipos no seu próprio ritmo."),"\n"),"\n",o.createElement(t.h2,null,"Um plano em duas fases"),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"A pipeline de migração de código consistia de múltiplas etapas:","\n",o.createElement(t.ol,null,"\n",o.createElement(t.li,null,"Conversão para JavaScript ES6;"),"\n",o.createElement(t.li,null,"Transformações com ",o.createElement(t.code,null,"codemod"),", especialmente de funções com binding para ",o.createElement(t.em,null,"arrow functions"),";"),"\n",o.createElement(t.li,null,"Transformação da API legada de React para JSX;"),"\n",o.createElement(t.li,null,"Conversão de AMD para módulos ES (especial cuidado com exports);"),"\n",o.createElement(t.li,null,"Anotação de parâmetros de função com ",o.createElement(t.code,null,"any"),";"),"\n",o.createElement(t.li,null,"Adição de declaração de membros de classes;"),"\n",o.createElement(t.li,null,"Anotação de componentes com tipos específicos de React;"),"\n",o.createElement(t.li,null,"Adição de comentário explicado como olhar o código CoffeeScript original através do ",o.createElement(t.code,null,"git"),";"),"\n"),"\n"),"\n",o.createElement(t.li,null,"A etapa final de correção dos tipos envolveu escrever scripts para interpretar os erros vindos do ",o.createElement(t.em,null,"type checking")," e aplicar as correções automaticamente."),"\n"),"\n",o.createElement(t.h2,null,"Mantendo o foco"),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"O compromisso de manter uma ferramenta suficientemente boa tornou trivial resolver manualmente problemas como variáveis mortas."),"\n",o.createElement(t.li,null,"Agrupar a quantidade de erros do ",o.createElement(t.code,null,"tsc")," por código de erro gerou uma métrica para a migração e confiança de que estavam na direção correta."),"\n",o.createElement(t.li,null,"A taxa de erros por arquivo ficou entre 0,5 e 1."),"\n"),"\n",o.createElement(t.h2,null,"Ganhando confiança nas suas ferramentas"),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"Bugs pré-existentes eram capturados rodando testes antes e após as conversões."),"\n",o.createElement(t.li,null,"Se um erro ocorria em muitos lugares, uma asserção era adicionada à pipeline de migração em vez de realizar correção manual."),"\n",o.createElement(t.li,null,"Um bug notável destes é relacionado a CoffeeScript não ter suporte a ",o.createElement(t.em,null,"variable shadowing"),"."),"\n",o.createElement(t.li,null,"O código foi inteiramente portado para o ",o.createElement(t.em,null,"strict mode")," sem problemas como atribuição em propriedades ",o.createElement(t.em,null,"read-only"),"."),"\n",o.createElement(t.li,null,"As primeiras conversões em massa foram feitas nos testes automáticos."),"\n",o.createElement(t.li,null,"Uma boa configuração do ",o.createElement(t.a,{href:"https://www.youtube.com/watch?v=muvU1DYrY0w"},"itest")," permitia checar rapidamente quais modificações eram a origem dos problemas."),"\n",o.createElement(t.li,null,"Foi importante ter rigor na escrita das traduções de código, cobrindo todos os ",o.createElement(t.em,null,"corner cases")," e explicitando quais casos eram ignorados."),"\n"),"\n",o.createElement(t.h2,null,"A última parte"),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"Nas últimas semanas as ferramentas eram capazes de converter entre 100 e 200 arquivos numa única passagem."),"\n",o.createElement(t.li,null,"Um dos truques para iterar rapidamente é rodar o ",o.createElement(t.em,null,"typecheck")," incremental (",o.createElement(t.code,null,"tsc --noEmit --watch"),")."),"\n",o.createElement(t.li,null,"O número de arquivos em CoffeeScript era mantido atualizado num quadro branco."),"\n",o.createElement(t.li,null,"Apenas dois bugs entraram em produção."),"\n",o.createElement(t.li,null,"Ao time mais resistente à mudança foi prometido que erros ficariam a cargo dos engenheiros envolvidos na migração."),"\n",o.createElement(t.li,null,"Ao se admitir como produto um código TypeScript não-idiomático, foram gastos 2 meses de trabalho de três engenheiros (cerca de 19 engenheiros-semana)."),"\n",o.createElement(t.li,null,'"Nós devemos economizar nosso capital político e organizacional com trabalhos que não podemos automatizar para todos"; assim, a conversão manual foi descartada.'),"\n",o.createElement(t.li,null,"Atualmente, o time da Dropbox mantém 2kk linhas de TypeScript."),"\n"))}var l=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,n.R)(),e.components);return t?o.createElement(t,e,o.createElement(r,e)):r(e)},i=a(7746),m=a(6008),c=a(9031),s=a(4615),d=a(4386);function u(e){let{pageContext:t,data:a,children:n}=e;const{frontmatter:{title:r,date:l},slug:i,next:u}=t;return o.createElement(o.Fragment,null,o.createElement(m.A,{title:r},o.createElement(c.A,{title:d.h.title,description:d.h.description}),o.createElement(s.A,{slug:i,title:r,date:Date.parse(l),timeToRead:Math.ceil(a.mdx.fields.timeToRead.minutes),next:u},n)))}function p(e){return o.createElement(u,e,o.createElement(l,e))}const f=e=>{let{pageContext:t,data:a,children:n}=e;const{frontmatter:{title:r}}=t,{excerpt:l}=a.mdx;return o.createElement(i.A,{title:r,description:l})}},6008:function(e,t,a){a.d(t,{A:function(){return f}});var n=a(6540),o=a(7581);const r="undefined"!=typeof window&&window.matchMedia?e=>{const{0:t,1:a}=(0,n.useState)((()=>matchMedia(e).matches));return(0,n.useEffect)((()=>{const t=matchMedia(e),n=()=>{a(t.matches)};return t.addEventListener("change",n),()=>{t.removeEventListener("change",n)}}),[e]),t}:e=>!1,l=(0,o.css)(["overflow-wrap:break-word;word-wrap:break-word;-ms-word-break:break-all;word-break:break-word;-ms-hyphens:auto;-moz-hyphens:auto;-webkit-hyphens:auto;hyphens:auto;"]),i=e=>e.theme.isDark?"#ececec":"hsl(0deg, 0%, 30%)",m=e=>e.theme.isDark?"hsl(0deg, 0%, 30%)":"#ececec",c=e=>e.theme.isDark?"hsla(0deg, 0%, 70%, 10%)":"hsla(0deg, 0%, 30%, 10%)",s="rgb(46, 170, 190)",d="rgba(46, 170, 190, 90%)",u=(0,o.createGlobalStyle)(["html{font-size:100%;font-family:Baskerville,'Baskerville Old Face','Goudy Old Style',Garamond,'Times New Roman',serif;scroll-behavior:smooth;}body{font-size:1rem;line-height:1.5;margin:0;color:",";background-color:",";padding:1rem;}h1,h2,h3,h4,h5,h6{line-height:1.1;font-family:inherit;font-weight:700;margin-top:3rem;margin-bottom:1.5rem;","}h1{font-size:2.35em}h2{font-size:2.00em}h3{font-size:1.75em}h4{font-size:1.5em}h5{font-size:1.25em}h6{font-size:1em}p{margin-top:0px;margin-bottom:2.5rem;}small,sub,sup{font-size:75%;}hr{border-color:",";}a{text-decoration:none;color:",";&:hover{color:",";border-bottom:1px dashed ",";}}ul{padding-left:1.4em;margin-top:0px;margin-bottom:2.5rem;}li{margin-bottom:0.4em;}blockquote{font-style:italic;margin-left:1.5em;padding-left:1em;border-left:3px solid ",";}img{height:auto;max-width:100%;margin-top:0px;margin-bottom:2.5rem;}pre{background-color:",";display:block;padding:1em;overflow-x:auto;margin-top:0px;margin-bottom:2.5rem;}code{font-size:0.9em;padding:0 0.5em;background-color:",";white-space:pre-wrap;}pre > code{padding:0;background-color:transparent;white-space:pre;}table{text-align:justify;width:100%;border-collapse:collapse;}td,th{padding:0.5em;border-bottom:1px solid ",";}input,textarea{border:1px solid ",";&:focus{border:1px solid ",';}}textarea{width:100%;}.button,button,input[type="submit"],input[type="reset"],input[type="button"]{display:inline-block;padding:5px 10px;text-align:center;text-decoration:none;white-space:nowrap;background-color:',";color:",";border-radius:1px;border:1px solid ",";cursor:pointer;box-sizing:border-box;&[disabled]{cursor:default;opacity:.5;}&:focus,&:hover{background-color:",";border-color:",";color:",";outline:0;}}textarea,select,input[type]{color:",";padding:6px 10px;margin-bottom:10px;background-color:",";border:1px solid ",";border-radius:4px;box-shadow:none;box-sizing:border-box;&:focus{border:1px solid ",';outline:0;}}input[type="checkbox"]:focus{outline:1px dotted ',";}label,legend,fieldset{display:block;margin-bottom:.5rem;font-weight:600;}"],i,m,l,s,s,d,i,s,c,c,c,i,s,s,m,s,d,d,m,i,c,c,s,s),p=o.default.h1.withConfig({displayName:"Layout__BodyTitle",componentId:"sc-uy8b5k-0"})(["display:none;"]);var f=function(e){let{children:t,title:a}=e;const l=r("(prefers-color-scheme: dark)");return n.createElement(o.ThemeProvider,{theme:{isDark:l}},n.createElement(u,null),n.createElement(p,null,a),t)}},4017:function(e,t,a){var n=a(4794),o=a(6540);t.A=function(e){let{href:t,title:a,children:r}=e;return o.createElement(n.Link,{to:t,title:a},r)}},9031:function(e,t,a){var n=a(6540),o=a(7581),r=a(4017);const l=o.default.nav.withConfig({displayName:"NavBar__StyledNavBar",componentId:"sc-yc90xv-0"})(["h1{font-size:1em;font-weight:normal;margin:0;}"]);t.A=function(e){let{title:t,description:a}=e;return n.createElement(l,null,n.createElement("h1",null,n.createElement(r.A,{href:"/",title:a},t)))}},4615:function(e,t,a){var n=a(6540),o=a(7581),r=a(4017);const l=o.default.div.withConfig({displayName:"Post__StyledPost",componentId:"sc-1lj2z18-0"})(["max-width:38em;margin:0 auto;"]),i=o.default.footer.withConfig({displayName:"Post__NextArticle",componentId:"sc-1lj2z18-1"})(["border-top:1pt dashed currentColor;text-align:right;text-align:end;"]);t.A=function(e){let{title:t,date:a,children:o,timeToRead:m,slug:c,next:s}=e;return n.createElement(l,null,n.createElement("header",null,n.createElement("h2",null,n.createElement(r.A,{href:c},t)),n.createElement("div",null,n.createElement("time",{dateTime:new Date(a).toISOString()},new Intl.DateTimeFormat("pt-BR",{dateStyle:"long",timeStyle:"short"}).format(a))," ","· ",m," ",1===m?"minuto":"minutos")),o&&n.createElement("article",null,o),s&&n.createElement(i,null,n.createElement(r.A,{href:s.slug},s.title)))}},7746:function(e,t,a){var n=a(6540),o=a(4386);t.A=function(e){const t=e.lang||o.h.lang,a=e.title?`${e.title} | ${o.h.title}`:o.h.title,r=e.description||o.h.description,l=o.h.twitterHandle;return n.createElement(n.Fragment,null,n.createElement("html",{lang:t}),n.createElement("title",null,a),n.createElement("meta",{name:"description",content:r}),n.createElement("meta",{property:"og:title",content:a}),n.createElement("meta",{property:"og:description",content:r}),n.createElement("meta",{property:"og:type",content:"website"}),n.createElement("meta",{name:"twitter:card",content:"summary"}),n.createElement("meta",{name:"twitter:creator",content:l}),n.createElement("meta",{name:"twitter:title",content:a}),n.createElement("meta",{name:"twitter:description",content:r}))}},4386:function(e,t,a){a.d(t,{h:function(){return n}});const n={lang:"pt-BR",title:"Tasso & As Vozes",description:"Um lugar calmo e tranquilo onde dialogo com as vozes que habitam a minha cabeça",twitterHandle:"@tassoevan"}},8453:function(e,t,a){a.d(t,{R:function(){return l}});var n=a(6540);const o={},r=n.createContext(o);function l(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}}}]);
//# sourceMappingURL=component---src-templates-post-tsx-content-file-path-posts-2020-05-24-notas-sobre-the-great-coffeescript-to-typescript-migration-of-2017-md-ba7cebdbfac85d579b7e.js.map