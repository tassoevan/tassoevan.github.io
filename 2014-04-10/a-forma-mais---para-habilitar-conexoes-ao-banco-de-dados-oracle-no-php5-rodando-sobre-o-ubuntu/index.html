<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.24bf1742e3764eb5de3c.css">/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}</style><meta name="generator" content="Gatsby 2.22.9"/><link rel="preconnect dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=bc48751fd07d92bd3e52d1773d38dc84"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#ececec"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=bc48751fd07d92bd3e52d1773d38dc84"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=bc48751fd07d92bd3e52d1773d38dc84"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=bc48751fd07d92bd3e52d1773d38dc84"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=bc48751fd07d92bd3e52d1773d38dc84"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=bc48751fd07d92bd3e52d1773d38dc84"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=bc48751fd07d92bd3e52d1773d38dc84"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=bc48751fd07d92bd3e52d1773d38dc84"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=bc48751fd07d92bd3e52d1773d38dc84"/><title data-react-helmet="true">A forma mais *@#$!* para habilitar conexões ao banco de dados Oracle no PHP5 rodando sobre o Ubuntu | Tasso &amp; As Vozes</title><meta data-react-helmet="true" name="description" content="Este artigo está disponível como  um gist . Sinta-se livre para contribuir. Agradecimentos especiais para: AJ ONeal Hsiao Siyuan Primeiro…"/><meta data-react-helmet="true" property="og:title" content="A forma mais *@#$!* para habilitar conexões ao banco de dados Oracle no PHP5 rodando sobre o Ubuntu"/><meta data-react-helmet="true" property="og:description" content="Este artigo está disponível como  um gist . Sinta-se livre para contribuir. Agradecimentos especiais para: AJ ONeal Hsiao Siyuan Primeiro…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@tassoevan"/><meta data-react-helmet="true" name="twitter:title" content="A forma mais *@#$!* para habilitar conexões ao banco de dados Oracle no PHP5 rodando sobre o Ubuntu"/><meta data-react-helmet="true" name="twitter:description" content="Este artigo está disponível como  um gist . Sinta-se livre para contribuir. Agradecimentos especiais para: AJ ONeal Hsiao Siyuan Primeiro…"/><style data-styled="fVazzd gGzgTu gLqRHV jJNLaa" data-styled-version="4.4.1">
/* sc-component-id: sc-global-3745505381 */
html{font-size:100%;font-family:Baskerville,'Baskerville Old Face','Goudy Old Style',Garamond,'Times New Roman',serif;-webkit-scroll-behavior:smooth;-moz-scroll-behavior:smooth;-ms-scroll-behavior:smooth;scroll-behavior:smooth;} body{font-size:1rem;line-height:1.5;margin:0;color:hsl(0deg,0%,30%);background-color:#ececec;padding:1rem;} h1,h2,h3,h4,h5,h6{line-height:1.1;font-family:inherit;font-weight:700;margin-top:3rem;margin-bottom:1.5rem;overflow-wrap:break-word;word-wrap:break-word;-ms-word-break:break-all;word-break:break-word;-ms-hyphens:auto;-moz-hyphens:auto;-webkit-hyphens:auto;-webkit-hyphens:auto;-moz-hyphens:auto;-ms-hyphens:auto;hyphens:auto;} h1{font-size:2.35em;} h2{font-size:2.00em;} h3{font-size:1.75em;} h4{font-size:1.5em;} h5{font-size:1.25em;} h6{font-size:1em;} p{margin-top:0px;margin-bottom:2.5rem;} small,sub,sup{font-size:75%;} hr{border-color:rgb(46,170,190);} a{-webkit-text-decoration:none;text-decoration:none;color:rgb(46,170,190);} a:hover{color:rgba(46,170,190,90%);border-bottom:1px dashed hsl(0deg,0%,30%);} ul{padding-left:1.4em;margin-top:0px;margin-bottom:2.5rem;} li{margin-bottom:0.4em;} blockquote{font-style:italic;margin-left:1.5em;padding-left:1em;border-left:3px solid rgb(46,170,190);} img{height:auto;max-width:100%;margin-top:0px;margin-bottom:2.5rem;} pre{background-color:hsla(0deg,0%,30%,10%);display:block;padding:1em;overflow-x:auto;margin-top:0px;margin-bottom:2.5rem;} code{font-size:0.9em;padding:0 0.5em;background-color:hsla(0deg,0%,30%,10%);white-space:pre-wrap;} pre > code{padding:0;background-color:transparent;white-space:pre;} table{text-align:justify;width:100%;border-collapse:collapse;} td,th{padding:0.5em;border-bottom:1px solid hsla(0deg,0%,30%,10%);} input,textarea{border:1px solid hsl(0deg,0%,30%);} input:focus,textarea:focus{border:1px solid rgb(46,170,190);} textarea{width:100%;} .button,button,input[type="submit"],input[type="reset"],input[type="button"]{display:inline-block;padding:5px 10px;text-align:center;-webkit-text-decoration:none;text-decoration:none;white-space:nowrap;background-color:rgb(46,170,190);color:#ececec;border-radius:1px;border:1px solid rgb(46,170,190);cursor:pointer;box-sizing:border-box;} .button[disabled],button[disabled],input[type="submit"][disabled],input[type="reset"][disabled],input[type="button"][disabled]{cursor:default;opacity:.5;} .button:focus,button:focus,input[type="submit"]:focus,input[type="reset"]:focus,input[type="button"]:focus,.button:hover,button:hover,input[type="submit"]:hover,input[type="reset"]:hover,input[type="button"]:hover{background-color:rgba(46,170,190,90%);border-color:rgba(46,170,190,90%);color:#ececec;outline:0;} textarea,select,input[type]{color:hsl(0deg,0%,30%);padding:6px 10px;margin-bottom:10px;background-color:hsla(0deg,0%,30%,10%);border:1px solid hsla(0deg,0%,30%,10%);border-radius:4px;box-shadow:none;box-sizing:border-box;} textarea:focus,select:focus,input[type]:focus{border:1px solid rgb(46,170,190);outline:0;} input[type="checkbox"]:focus{outline:1px dotted rgb(46,170,190);} label,legend,fieldset{display:block;margin-bottom:.5rem;font-weight:600;}
/* sc-component-id: Layout__BodyTitle-ivn37c-0 */
.fVazzd{display:none;}
/* sc-component-id: Post__StyledPost-sc-22n9ff-0 */
.gLqRHV{max-width:38em;margin:0 auto;}
/* sc-component-id: Post__NextArticle-sc-22n9ff-1 */
.jJNLaa{border-top:1pt dashed currentColor;text-align:right;text-align:end;}
/* sc-component-id: NavBar__StyledNavBar-cvp94v-0 */
.gGzgTu h1{font-size:1em;font-weight:normal;margin:0;}</style><link as="script" rel="preload" href="/webpack-runtime-4167aa3984e85b9f3115.js"/><link as="script" rel="preload" href="/framework-b482fcc869860d486f96.js"/><link as="script" rel="preload" href="/app-b6f05a09e1c904b518fc.js"/><link as="script" rel="preload" href="/styles-823ae8103e36ae8a7f9f.js"/><link as="script" rel="preload" href="/commons-377e0f1cb86650f6ffd1.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-50a31516e37288593ff7.js"/><link as="fetch" rel="preload" href="/page-data/2014-04-10/a-forma-mais---para-habilitar-conexoes-ao-banco-de-dados-oracle-no-php5-rodando-sobre-o-ubuntu/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><h1 class="Layout__BodyTitle-ivn37c-0 fVazzd">Tasso &amp; As Vozes</h1><nav class="NavBar__StyledNavBar-cvp94v-0 gGzgTu"><h1><a title="Um lugar calmo e tranquilo onde dialogo com as vozes que habitam a minha cabeça" href="/">Tasso &amp; As Vozes</a></h1></nav><div class="Post__StyledPost-sc-22n9ff-0 gLqRHV"><header><h2><a aria-current="page" class="" href="/2014-04-10/a-forma-mais---para-habilitar-conexoes-ao-banco-de-dados-oracle-no-php5-rodando-sobre-o-ubuntu/">A forma mais *@#$!* para habilitar conexões ao banco de dados Oracle no PHP5 rodando sobre o Ubuntu</a></h2><div><time dateTime="2014-04-10T15:29:52.000Z">10 de abril de 2014 às 15:29</time> · <!-- -->1<!-- --> <!-- -->minuto</div></header><article><p>Este artigo está disponível como <a href="https://gist.github.com/tassoevan/10392954">um gist</a>. Sinta-se livre para contribuir.</p><p>Agradecimentos especiais para:</p><ul><li><a href="https://twitter.com/coolaj86">AJ ONeal</a></li><li><a href="http://hsiaosiyuan.com/wp/">Hsiao Siyuan</a></li></ul><h1>Primeiro passo: Instalação do cliente Oracle</h1><ol><li><p>Faça o download do Instant Client em <a href="http://www.oracle.com/technetwork/indexes/downloads/index.html#database">http://www.oracle.com/technetwork/indexes/downloads/index.html#database</a> (você deve ter um usuário registrado no site da Oracle; o registro é gratuito). Você precisa dos arquivos <code>instantclient-basic-*-*.zip</code> e <code>instantclient-sdk-*-*.zip</code>.</p></li><li><p>Execute os seguintes comandos no seu terminal:</p><pre><code>$ sudo su -
$ mkdir -p /opt/oracle/instantclient
$ cd /opt/oracle/instantclient
</code></pre></li><li><p>Copie os arquivos baixados em <code>/opt/oracle/instantclient</code>.</p></li><li><p>Descompacte os arquivos executando estes comandos:</p><pre><code>$ unzip instantclient-basic-*-*.zip
$ unzip instantclient-sdk-*-*.zip
</code></pre></li><li><p>Mova todos o conteúdo de <code>/opt/oracle/instantclient/instantclient</code> para <code>/opt/oracle/instantclient</code>:</p><pre><code>$ mv instantclient*/* ./
$ rmdir instantclient*/
</code></pre></li><li><p>Durante a compilação do código da extensão, alguns erros podem surgir quando forem resolvidas as dependências de algumas libraries. Para evitá-los, faça:</p><pre><code>$ ln -s libclntsh.so.* libclntsh.so
$ ln -s libocci.so.* libocci.so
$ echo /opt/oracle/instantclient &gt;&gt; /etc/ld.so.conf
$ ldconfig
</code></pre></li><li><p>Crie um diretório para seus arquivos de configuração de rede:</p><pre><code>$ mkdir -p network/admin
</code></pre></li><li><p>Coloque os arquivos <code>sqlnet.ora</code> e <code>tnsnames.ora</code> em <code>/opt/oracle/instantclient/network/admin</code>.</p></li></ol><p>Agora você tem o kit básico para conexões e acesso à SDK para compilar extensões PHP com Oracle.</p><h1>Segundo passo: Instalação da extensão PHP OCI8</h1><ol><li><p>Pegue todos os pacotes essenciais para baixar e compilar a partir de repositórios PEAR:</p><pre><code>$ apt-get install --yes php5 php5-cli php5-dev php-db php-pear
$ apt-get install --yes build-essential libaio1
</code></pre></li><li><p>Requisite a instalação do OCI8:</p><pre><code>$ pecl install oci8
</code></pre><p>Digite <code>instantclient,/opt/oracle/instantclient</code> quando perguntado pelo local de instalação do Instant Client.</p></li><li><p>Salve este texto em <code>/etc/php5/mods-available/oci8.ini</code>:</p><pre><code>extension=oci8.so
</code></pre></li><li><p>Ative a extensão:</p><pre><code>$ php5enmod oci8
</code></pre></li></ol><p>Agora você tem todas as funções PHP <code>oci_*</code> disponíveis tanto via php-cli quanto via Apache.</p><h1>Terceiro passo: Instalação da extensão PHP PDO/OCI</h1><p>A biblioteca <code>pdo_oci</code> está desatualizada, então sua instalação é mais &quot;engenhosa&quot;.</p><ol><li><p>Corrija alguns caminhos de arquivo:</p><pre><code>$ cd /usr/include/
$ ln -s php5 php
$ cd /opt/oracle/instantclient
$ mkdir -p include/oracle/11.1/
$ cd include/oracle/11.1/
$ ln -s ../../../sdk/include client
$ cd -
$ mkdir -p lib/oracle/11.1/client
$ cd lib/oracle/11.1/client
$ ln -s ../../../../ lib
$ cd -
</code></pre></li><li><p>Baixe a <code>pdo_oci</code> via <code>pecl</code>:</p><pre><code>$ pecl channel-update pear.php.net
$ mkdir -p /tmp/pear/download/
$ cd /tmp/pear/download/
$ pecl download pdo_oci
</code></pre></li><li><p>Extraia o código-fonte:</p><pre><code>$ tar xvf PDO_OCI*.tgz
$ cd PDO_OCI*
</code></pre></li><li><p>Crie um arquivo chamado <code>config.m4.patch</code>:</p><pre><code>*** config.m4   2005-09-24 17:23:24.000000000 -0600
--- /home/myuser/Desktop/PDO_OCI-1.0/config.m4  2009-07-07 17:32:14.000000000 -0600
***************
*** 7,12 ****
--- 7,14 ----
    if test -s &quot;$PDO_OCI_DIR/orainst/unix.rgs&quot;; then
      PDO_OCI_VERSION=`grep &#x27;&quot;ocommon&quot;&#x27; $PDO_OCI_DIR/orainst/unix.rgs | sed &#x27;s/[ ][ ]*/:/g&#x27; | cut -d: -f 6 | cut -c 2-4`
      test -z &quot;$PDO_OCI_VERSION&quot; &amp;&amp; PDO_OCI_VERSION=7.3
+   elif test -f $PDO_OCI_DIR/lib/libclntsh.$SHLIB_SUFFIX_NAME.11.1; then
+     PDO_OCI_VERSION=11.1
    elif test -f $PDO_OCI_DIR/lib/libclntsh.$SHLIB_SUFFIX_NAME.10.1; then
      PDO_OCI_VERSION=10.1
    elif test -f $PDO_OCI_DIR/lib/libclntsh.$SHLIB_SUFFIX_NAME.9.0; then
***************
*** 119,124 ****
--- 121,129 ----
      10.2)
        PHP_ADD_LIBRARY(clntsh, 1, PDO_OCI_SHARED_LIBADD)
        ;;
+     11.1)
+       PHP_ADD_LIBRARY(clntsh, 1, PDO_OCI_SHARED_LIBADD)
+       ;;
      *)
        AC_MSG_ERROR(Unsupported Oracle version! $PDO_OCI_VERSION)
        ;;
#EOF
</code></pre></li><li><p>Aplique o patch:</p><pre><code>$ patch --dry-run -i config.m4.patch &amp;&amp; patch -i config.m4.patch &amp;&amp; phpize
</code></pre></li><li><p>Substitua todas as referências de <code>function_entry</code> para <code>zend_function_entry</code> em <code>pdo_oci.c</code>.</p></li><li><p>Configure, compile e instale:</p><pre><code>$ ORACLE_HOME=/opt/oracle/instantclient ./configure --with-pdo-oci=instantclient,/opt/oracle/instantclient,11.1
$ make &amp;&amp; make test &amp;&amp; make install &amp;&amp; mv modules/pdo_oci.so /usr/lib/php5/*+lfs/
</code></pre></li><li><p>Salve este texto em <code>/etc/php5/mods-available/pdo_oci.ini</code>:</p><pre><code>extension=pdo_oci.so
</code></pre></li><li><p>Ative a extensão:</p><pre><code>$ php5enmod pdo_oci
</code></pre></li></ol><p>E agora você pode pegar uma xícara de café.</p></article><footer class="Post__NextArticle-sc-22n9ff-1 jJNLaa"><a href="/2013-07-24/interpretando-urls-com-dom/">Interpretando URLs com DOM</a></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-31191590-3', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2014-04-10/a-forma-mais---para-habilitar-conexoes-ao-banco-de-dados-oracle-no-php5-rodando-sobre-o-ubuntu/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-b6f05a09e1c904b518fc.js"],"component---src-pages-index-js":["/component---src-pages-index-js-e663c63acffcd1b49256.js"],"component---src-templates-post-js":["/component---src-templates-post-js-50a31516e37288593ff7.js"]};/*]]>*/</script><script src="/component---src-templates-post-js-50a31516e37288593ff7.js" async=""></script><script src="/commons-377e0f1cb86650f6ffd1.js" async=""></script><script src="/styles-823ae8103e36ae8a7f9f.js" async=""></script><script src="/app-b6f05a09e1c904b518fc.js" async=""></script><script src="/framework-b482fcc869860d486f96.js" async=""></script><script src="/webpack-runtime-4167aa3984e85b9f3115.js" async=""></script></body></html>